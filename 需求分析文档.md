# 黑名单管理系统需求分析文档

## 项目概述

本项目旨在开发一个完整的黑名单管理系统，采用前后端分离架构，提供用户管理、权限控制、黑名单数据管理、订单筛查等核心功能。系统将帮助商家有效识别和防范欺诈行为，建立完善的黑名单数据管理体系。

## 数据源分析

### 1. 黑名单数据源 (`副本-5_ktt手作骗子持更2025版.xlsx`)

**数据规模**：
- 总记录数：197条
- 字段数：7个主要字段

**字段结构**：
1. **ktt名字** (144/197, 73.1%完整率)
   - 用途：KTT平台用户名
   - 示例：晴天、高兴开心麻麻（两个号）、王越.（重点怀疑是开心麻麻）

2. **微信名字** (77/197, 39.1%完整率)
   - 用途：微信昵称
   - 示例：高兴开心麻麻or面具小号、烨

3. **微信号** (75/197, 38.1%完整率)
   - 用途：微信号或小红书号
   - 示例：小红书号：607487659、wry20060110

4. **下单名字和电话** (167/197, 84.8%完整率)
   - 用途：包含下单人姓名和联系电话的复合字段
   - 示例：晴天13871090879、王18766179570/李军17865658357
   - **关键信息**：可提取159个唯一电话号码

5. **下单地址1** (167/197, 84.8%完整率)
   - 用途：主要收货地址
   - 示例：湖北省武汉市江汉区汉兴街街道常青五路47号远洋心里

6. **下单地址2** (25/197, 12.7%完整率)
   - 用途：备用收货地址
   - 示例：山东省济南市章丘区中心大街相公庄镇袁庄新区西侧约90米相公人家

7. **入黑名单原因** (152/197, 77.2%完整率)
   - 用途：违规原因说明
   - 示例：骗不下十家的惯犯、不走正渠道下单

### 2. 用户上传数据 (`00.xlsx`)

**数据规模**：
- 总订单数：11,287条
- 字段数：15个字段

**关键匹配字段**：
1. **下单人** (1018个唯一值)
   - 用途：下单用户名
   - 示例：Babe、牛奶罐子w、有一丢丢法力的小神仙💫

2. **收货人** (1003个唯一值)
   - 用途：收货人姓名
   - 示例：pbb、刘、heeseung

3. **联系电话** (1053个唯一值)
   - 用途：联系电话号码
   - 格式：11位手机号
   - 示例：18663971976、15221390121

4. **详细地址** (1054个唯一值)
   - 用途：详细收货地址
   - 示例：山东省青岛市市南区仙居路24号楼一单元603室

## 匹配策略设计

### 优先级排序

根据数据质量和匹配准确性，制定以下优先级策略：

#### 1. 联系电话匹配 (优先级：最高)
- **匹配方式**：精确匹配
- **数据来源**：
  - 黑名单：从"下单名字和电话"字段提取电话号码（159个唯一号码）
  - 用户数据：直接使用"联系电话"字段（1053个唯一号码）
- **匹配逻辑**：字符串完全匹配
- **优势**：准确性最高，误报率最低

#### 2. 下单名字匹配 (优先级：第二)
- **匹配方式**：模糊匹配
- **数据来源**：
  - 黑名单：从"下单名字和电话"字段提取姓名部分
  - 用户数据：使用"下单人"或"收货人"字段
- **匹配逻辑**：
  - 去除特殊字符和空格
  - 支持部分匹配
  - 考虑昵称变化
- **优势**：覆盖面广，能识别改名用户

#### 3. ktt名字匹配 (优先级：第三)
- **匹配方式**：模糊匹配
- **数据来源**：
  - 黑名单：使用"ktt名字"字段
  - 用户数据：使用"下单人"字段
- **匹配逻辑**：
  - 支持部分匹配
  - 考虑括号内的备注信息
- **优势**：能识别平台用户名变化

#### 4. 下单地址匹配 (优先级：最低)
- **匹配方式**：模糊匹配
- **数据来源**：
  - 黑名单：使用"下单地址1"和"下单地址2"字段
  - 用户数据：使用"详细地址"字段
- **匹配逻辑**：
  - 提取关键地址信息（省市区）
  - 支持部分匹配
- **优势**：能识别地址变化但地区相同的情况

## 功能需求

### 1. 数据上传功能
- 支持Excel文件上传
- 文件格式验证
- 数据完整性检查
- 错误提示和日志记录

### 2. 数据解析功能
- 自动识别Excel文件结构
- 字段映射配置
- 数据清洗和标准化
- 异常数据处理

### 3. 黑名单匹配功能
- 多层级匹配算法
- 匹配结果评分
- 疑似度分级（高/中/低）
- 匹配详情展示

### 4. 结果输出功能
- 疑似黑名单用户列表
- 匹配原因说明
- 原始数据对比
- 导出功能（Excel/PDF）

### 5. 数据管理功能
- 黑名单数据更新
- 版本管理
- 备份恢复
- 数据统计

## 系统架构设计

### 1. 整体架构
采用前后端分离架构，支持高并发、可扩展的企业级应用。

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Vue3 前端     │    │   Python 后端   │    │   MySQL 数据库  │
│                 │    │                 │    │                 │
│ - 用户界面      │◄──►│ - RESTful API   │◄──►│ - 用户数据      │
│ - 数据展示      │    │ - 业务逻辑      │    │ - 黑名单数据    │
│ - 交互操作      │    │ - 权限控制      │    │ - 订单数据      │
│ - 权限控制      │    │ - 数据匹配      │    │ - 系统配置      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2. 前端技术栈 (Vue3)
- **核心框架**：Vue 3 + TypeScript
- **构建工具**：Vite
- **UI框架**：Element Plus
- **状态管理**：Pinia
- **路由管理**：Vue Router 4
- **HTTP客户端**：Axios
- **图表组件**：ECharts
- **表单验证**：VeeValidate
- **开发工具**：ESLint + Prettier

### 3. 后端技术栈 (Python)
- **Web框架**：FastAPI（高性能异步框架）
- **数据库ORM**：SQLAlchemy 2.0
- **数据库驱动**：PyMySQL
- **认证授权**：JWT + OAuth2
- **数据处理**：Pandas + NumPy
- **文本匹配**：fuzzywuzzy + regex
- **任务队列**：Celery + Redis
- **API文档**：Swagger UI
- **日志管理**：loguru
- **配置管理**：Pydantic Settings
- **数据验证**：Pydantic

### 4. 数据库设计 (MySQL)
- **数据库**：MySQL 8.0+
- **连接池**：SQLAlchemy连接池
- **索引优化**：针对查询字段建立索引
- **数据备份**：定期自动备份
- **主从复制**：支持读写分离

### 5. 部署架构
- **容器化**：Docker + Docker Compose
- **反向代理**：Nginx
- **负载均衡**：Nginx负载均衡
- **缓存**：Redis
- **文件存储**：本地存储或云存储
- **监控**：Prometheus + Grafana

## 功能模块设计

### 1. 用户管理模块
- **用户注册/登录**：支持邮箱注册，JWT认证
- **权限管理**：基于角色的访问控制(RBAC)
- **用户信息管理**：个人资料、密码修改
- **操作日志**：用户行为审计

### 2. 黑名单管理模块
- **数据导入**：Excel模板导入、手动录入
- **数据编辑**：增删改查操作
- **数据验证**：字段格式验证、重复检查
- **版本管理**：数据变更历史记录
- **批量操作**：批量导入、批量删除

### 3. 订单筛查模块
- **文件上传**：支持Excel订单文件上传
- **数据解析**：自动识别文件结构
- **智能匹配**：多层级匹配算法
- **结果展示**：疑似度分级、详细对比
- **结果导出**：Excel/PDF格式导出

### 4. 系统管理模块
- **系统配置**：匹配规则配置
- **数据统计**：黑名单统计、筛查统计
- **日志管理**：系统日志、操作日志
- **数据备份**：自动备份、手动备份

## 数据库设计

### 1. 用户相关表
```sql
-- 用户表
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    phone VARCHAR(20),
    role_id INT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 角色表
CREATE TABLE roles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    permissions JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 权限表
CREATE TABLE permissions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) UNIQUE NOT NULL,
    resource VARCHAR(50) NOT NULL,
    action VARCHAR(50) NOT NULL,
    description TEXT
);
```

### 2. 黑名单相关表
```sql
-- 黑名单主表
CREATE TABLE blacklist (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ktt_name VARCHAR(100),
    wechat_name VARCHAR(100),
    wechat_id VARCHAR(100),
    order_name_phone TEXT,
    phone_numbers JSON,
    order_address1 TEXT,
    order_address2 TEXT,
    blacklist_reason TEXT,
    risk_level ENUM('low', 'medium', 'high') DEFAULT 'medium',
    is_active BOOLEAN DEFAULT TRUE,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_phone (phone_numbers),
    INDEX idx_ktt_name (ktt_name),
    INDEX idx_created_at (created_at)
);

-- 黑名单变更历史表
CREATE TABLE blacklist_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    blacklist_id INT,
    action ENUM('create', 'update', 'delete') NOT NULL,
    old_data JSON,
    new_data JSON,
    changed_by INT,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (blacklist_id) REFERENCES blacklist(id)
);
```

### 3. 订单筛查相关表
```sql
-- 筛查任务表
CREATE TABLE screening_tasks (
    id INT PRIMARY KEY AUTO_INCREMENT,
    task_name VARCHAR(200) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500),
    total_records INT DEFAULT 0,
    processed_records INT DEFAULT 0,
    matched_records INT DEFAULT 0,
    status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- 筛查结果表
CREATE TABLE screening_results (
    id INT PRIMARY KEY AUTO_INCREMENT,
    task_id INT,
    blacklist_id INT,
    order_data JSON,
    match_type ENUM('phone', 'name', 'ktt_name', 'address') NOT NULL,
    match_score DECIMAL(5,2),
    match_details TEXT,
    risk_level ENUM('low', 'medium', 'high') DEFAULT 'medium',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (task_id) REFERENCES screening_tasks(id),
    FOREIGN KEY (blacklist_id) REFERENCES blacklist(id),
    INDEX idx_task_id (task_id),
    INDEX idx_risk_level (risk_level)
);
```

## 项目结构设计

### 后端项目结构
```
blacklist-backend/
├── app/
│   ├── api/
│   │   ├── v1/
│   │   │   ├── auth.py              # 认证相关API
│   │   │   ├── users.py             # 用户管理API
│   │   │   ├── blacklist.py         # 黑名单管理API
│   │   │   ├── screening.py         # 订单筛查API
│   │   │   └── admin.py             # 系统管理API
│   │   └── deps.py                  # 依赖注入
│   ├── core/
│   │   ├── config.py                # 配置管理
│   │   ├── security.py              # 安全相关
│   │   ├── database.py              # 数据库配置
│   │   └── exceptions.py            # 异常处理
│   ├── models/
│   │   ├── user.py                  # 用户模型
│   │   ├── blacklist.py             # 黑名单模型
│   │   ├── screening.py             # 筛查模型
│   │   └── base.py                  # 基础模型
│   ├── schemas/
│   │   ├── user.py                  # 用户数据模式
│   │   ├── blacklist.py             # 黑名单数据模式
│   │   └── screening.py             # 筛查数据模式
│   ├── services/
│   │   ├── auth_service.py          # 认证服务
│   │   ├── blacklist_service.py     # 黑名单服务
│   │   ├── screening_service.py     # 筛查服务
│   │   └── file_service.py          # 文件处理服务
│   ├── utils/
│   │   ├── text_processor.py        # 文本处理
│   │   ├── phone_extractor.py       # 电话号码提取
│   │   ├── matcher.py               # 匹配算法
│   │   └── excel_processor.py       # Excel处理
│   └── main.py                      # 应用入口
├── tests/
├── migrations/                       # 数据库迁移
├── requirements.txt
├── docker-compose.yml
├── Dockerfile
└── README.md
```

### 前端项目结构
```
blacklist-frontend/
├── src/
│   ├── components/                   # 通用组件
│   │   ├── common/                   # 基础组件
│   │   ├── layout/                   # 布局组件
│   │   └── business/                 # 业务组件
│   ├── views/                        # 页面组件
│   │   ├── auth/                     # 认证页面
│   │   ├── dashboard/                # 仪表板
│   │   ├── blacklist/                # 黑名单管理
│   │   ├── screening/                # 订单筛查
│   │   └── admin/                    # 系统管理
│   ├── stores/                       # Pinia状态管理
│   ├── router/                       # 路由配置
│   ├── api/                          # API接口
│   ├── utils/                        # 工具函数
│   ├── types/                        # TypeScript类型
│   └── assets/                       # 静态资源
├── public/
├── package.json
├── vite.config.ts
├── tsconfig.json
└── README.md
```

## API接口设计

### 1. 认证相关接口
```
POST /api/v1/auth/register          # 用户注册
POST /api/v1/auth/login             # 用户登录
POST /api/v1/auth/refresh           # 刷新token
POST /api/v1/auth/logout            # 用户登出
GET  /api/v1/auth/me                # 获取当前用户信息
```

### 2. 用户管理接口
```
GET    /api/v1/users                # 获取用户列表
POST   /api/v1/users                # 创建用户
GET    /api/v1/users/{user_id}      # 获取用户详情
PUT    /api/v1/users/{user_id}      # 更新用户信息
DELETE /api/v1/users/{user_id}      # 删除用户
PUT    /api/v1/users/{user_id}/role # 更新用户角色
```

### 3. 黑名单管理接口
```
GET    /api/v1/blacklist                    # 获取黑名单列表
POST   /api/v1/blacklist                    # 创建黑名单记录
GET    /api/v1/blacklist/{id}               # 获取黑名单详情
PUT    /api/v1/blacklist/{id}               # 更新黑名单记录
DELETE /api/v1/blacklist/{id}               # 删除黑名单记录
POST   /api/v1/blacklist/import             # 批量导入黑名单
GET    /api/v1/blacklist/export             # 导出黑名单
GET    /api/v1/blacklist/{id}/history       # 获取变更历史
```

### 4. 订单筛查接口
```
POST   /api/v1/screening/upload             # 上传订单文件
GET    /api/v1/screening/tasks              # 获取筛查任务列表
GET    /api/v1/screening/tasks/{task_id}    # 获取任务详情
POST   /api/v1/screening/tasks/{task_id}/start # 开始筛查任务
GET    /api/v1/screening/results/{task_id}  # 获取筛查结果
POST   /api/v1/screening/results/{task_id}/export # 导出结果
```

### 5. 系统管理接口
```
GET    /api/v1/admin/stats                  # 获取系统统计
GET    /api/v1/admin/logs                   # 获取系统日志
POST   /api/v1/admin/backup                 # 创建数据备份
GET    /api/v1/admin/config                 # 获取系统配置
PUT    /api/v1/admin/config                 # 更新系统配置
```

## 权限设计

### 1. 角色定义
- **超级管理员**：系统完全控制权限
- **管理员**：用户管理、黑名单管理、系统配置
- **操作员**：黑名单管理、订单筛查
- **查看者**：仅可查看数据，无修改权限

### 2. 权限矩阵
| 功能模块 | 超级管理员 | 管理员 | 操作员 | 查看者 |
|---------|-----------|--------|--------|--------|
| 用户管理 | ✓ | ✓ | ✗ | ✗ |
| 黑名单管理 | ✓ | ✓ | ✓ | ✓ |
| 订单筛查 | ✓ | ✓ | ✓ | ✓ |
| 系统配置 | ✓ | ✓ | ✗ | ✗ |
| 数据统计 | ✓ | ✓ | ✓ | ✓ |
| 日志查看 | ✓ | ✓ | ✓ | ✗ |

## 开发计划

### 第一阶段：基础架构搭建 (2周)
1. **后端基础框架**
   - FastAPI项目初始化
   - 数据库连接和模型定义
   - JWT认证系统
   - 基础API接口

2. **前端基础框架**
   - Vue3项目初始化
   - 路由和状态管理配置
   - 基础组件库集成
   - 认证页面开发

3. **数据库设计**
   - MySQL数据库创建
   - 表结构设计和索引优化
   - 初始数据导入脚本

### 第二阶段：核心功能开发 (3周)
1. **用户管理模块**
   - 用户注册/登录功能
   - 权限控制系统
   - 用户信息管理

2. **黑名单管理模块**
   - 黑名单CRUD操作
   - Excel导入功能
   - 数据验证和清洗

3. **订单筛查模块**
   - 文件上传功能
   - 匹配算法实现
   - 结果展示和导出

### 第三阶段：功能完善 (2周)
1. **高级功能**
   - 批量操作功能
   - 数据统计分析
   - 系统配置管理

2. **用户体验优化**
   - 界面美化
   - 交互优化
   - 响应式设计

### 第四阶段：测试和部署 (1周)
1. **测试**
   - 单元测试
   - 集成测试
   - 性能测试

2. **部署**
   - Docker容器化
   - 生产环境部署
   - 监控配置

## 技术难点和解决方案

### 1. 大数据量处理
- **问题**：大量订单数据匹配性能问题
- **解决方案**：分批处理、异步任务队列、数据库索引优化

### 2. 模糊匹配准确性
- **问题**：姓名、地址模糊匹配准确率
- **解决方案**：多算法结合、置信度评分、人工审核机制

### 3. 数据安全性
- **问题**：敏感数据保护
- **解决方案**：数据加密、访问控制、操作审计

### 4. 系统可扩展性
- **问题**：系统负载和扩展能力
- **解决方案**：微服务架构、负载均衡、缓存机制

## 风险评估

### 1. 数据质量风险
- **风险**：黑名单数据不完整（部分字段缺失率较高）
- **应对**：建立数据质量检查机制，支持手动补充

### 2. 匹配准确性风险
- **风险**：模糊匹配可能产生误报
- **应对**：建立置信度评分机制，人工审核高疑似度结果

### 3. 性能风险
- **风险**：大量数据匹配可能影响性能
- **应对**：采用分批处理，优化算法效率

### 4. 数据安全风险
- **风险**：敏感信息泄露
- **应对**：数据加密存储，访问权限控制

## 部署架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户访问层                            │
├─────────────────────────────────────────────────────────────┤
│  Nginx (反向代理/负载均衡)                                   │
├─────────────────────────────────────────────────────────────┤
│                    应用服务层                               │
│  ┌─────────────────┐              ┌─────────────────┐      │
│  │   Vue3 前端     │              │  FastAPI 后端   │      │
│  │   (Docker)      │              │   (Docker)      │      │
│  └─────────────────┘              └─────────────────┘      │
├─────────────────────────────────────────────────────────────┤
│                      数据存储层                             │
│  ┌─────────────────┐              ┌─────────────────┐      │
│  │   MySQL 主库    │              │    Redis        │      │
│  │   (Docker)      │              │   (Docker)      │      │
│  └─────────────────┘              └─────────────────┘      │
│  ┌─────────────────┐                                       │
│  │   MySQL 从库    │                                       │
│  │   (Docker)      │                                       │
│  └─────────────────┘                                       │
├─────────────────────────────────────────────────────────────┤
│                      监控和日志                             │
│  ┌─────────────────┐              ┌─────────────────┐      │
│  │   Prometheus    │              │    Grafana      │      │
│  │   (Docker)      │              │   (Docker)      │      │
│  └─────────────────┘              └─────────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

## 初始数据导入方案

### 1. 数据导入脚本设计
- **目标**：将`副本-5_ktt手作骗子持更2025版.xlsx`数据导入MySQL数据库
- **处理流程**：
  1. 读取Excel文件，跳过说明行
  2. 数据清洗和标准化
  3. 电话号码提取和解析
  4. 数据验证和去重
  5. 批量插入数据库

### 2. 数据导入接口
```python
# 后端API接口
POST /api/v1/admin/import-initial-data
```

### 3. 数据导入监控
- 导入进度显示
- 错误日志记录
- 数据质量报告

## 系统特色功能

### 1. 智能匹配引擎
- **多算法融合**：精确匹配 + 模糊匹配 + 语义匹配
- **动态权重**：根据数据质量自动调整匹配权重
- **学习优化**：基于用户反馈持续优化匹配算法

### 2. 实时监控面板
- **系统状态**：服务健康状态、数据库连接状态
- **性能指标**：响应时间、并发数、错误率
- **业务指标**：黑名单数量、筛查任务数、匹配成功率

### 3. 数据可视化
- **统计图表**：黑名单趋势、风险等级分布
- **地理分布**：基于地址的黑名单地理分布图
- **时间分析**：黑名单添加时间趋势分析

### 4. 移动端支持
- **响应式设计**：支持手机、平板访问
- **PWA应用**：可安装的渐进式Web应用
- **离线功能**：基础功能离线可用

## 总结

本项目采用现代化的前后端分离架构，使用Vue3 + FastAPI + MySQL的技术栈，构建了一个功能完整、安全可靠的黑名单管理系统。系统具备以下核心优势：

1. **技术先进性**：采用最新的技术栈，支持高并发和大数据处理
2. **功能完整性**：涵盖用户管理、权限控制、数据管理、智能筛查等完整功能
3. **安全可靠性**：完善的权限控制和数据保护机制
4. **可扩展性**：模块化设计，支持功能扩展和性能扩展
5. **用户体验**：现代化的UI设计和流畅的交互体验

该系统可以有效帮助商家识别和防范欺诈行为，建立完善的黑名单数据管理体系，提升业务安全性和运营效率。
